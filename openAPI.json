{
  "openapi": "3.1.0",
  "info": {
    "title": "Excel GPT Middleware API",
    "version": "1.2.2",
    "description": "Express API middleware for Microsoft Graph Excel with name-based resolution, recursive search, Excel engine formatting, intelligent find/replace, and rename operations.\nNotes:\n- All Excel and rename endpoints are mounted under /api/excel. Health endpoints are under /health.\n- Name-vs-ID: All endpoints accept human-friendly names (driveName, folderName, fileName, sheetName) with automatic name-to-ID resolution and backward compatibility for IDs.\n- Path disambiguation: When duplicate file names exist, you can pass itemPath (e.g., '/Folder/Subfolder/My.xlsx').\n- Error envelope is consistent: { status: \"success\" | \"error\" | \"partial_success\" | \"preview\" | \"multiple_matches\" | \"no_matches\", ... }. Success responses include status: \"success\" and may include data.\n- Update 1.2.1: GET /api/excel/workbooks items include a 'fullPath' field representing the folder path (e.g., '/Folder/Sub/file.xlsx').\n- Update 1.2.2: POST /api/excel/find-replace supports preview â†’ apply with mode, strategy (text/entityName), sheetScope, and selection/selectAll. Preview returns 409 confirmation_required with selectable matches."
  },
  "servers": [
    {
      "url": "https://excel-middleware.vercel.app",
      "description": "Production"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Basic health check",
        "operationId": "healthBasic",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthSuccess"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/clear-data": {
      "post": {
        "summary": "Clear worksheet data (entire usedRange or a specific range)",
        "operationId": "clearData",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ClearDataRequest" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Clear success",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ClearDataSuccess" }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/EnvelopeError" }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/EnvelopeError" }
              }
            }
          }
        }
      }
    },
    "/api/excel/workbooks": {
      "get": {
        "summary": "List Excel workbooks in the resolved drive/folder (recursive where applicable)",
        "operationId": "listWorkbooks",
        "parameters": [
          {
            "in": "query",
            "name": "siteId",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site ID override"
          },
          {
            "in": "query",
            "name": "siteUrl",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site URL override"
          },
          {
            "in": "query",
            "name": "sharepointHostname",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint hostname override (tenant.sharepoint.com)"
          },
          {
            "in": "query",
            "name": "sharepointSiteName",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint site name override (e.g., Finance)"
          },
          {
            "in": "query",
            "name": "driveName",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional drive name (auto-selected if single drive)."
          }
        ],
        "responses": {
          "200": {
            "description": "List success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListItemsSuccess"
                }
              }
            }
          },
          "400": {
            "description": "Ambiguous drive selection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorWithAvailableDrives"
                }
              }
            }
          },
          "500": {
            "description": "Server or Graph error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/worksheets": {
      "get": {
        "summary": "List worksheets in a workbook",
        "operationId": "getWorksheets",
        "parameters": [
          {
            "in": "query",
            "name": "siteId",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site ID override"
          },
          {
            "in": "query",
            "name": "siteUrl",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site URL override"
          },
          {
            "in": "query",
            "name": "sharepointHostname",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint hostname override (tenant.sharepoint.com)"
          },
          {
            "in": "query",
            "name": "sharepointSiteName",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint site name override (e.g., Finance)"
          },
          {
            "in": "query",
            "name": "driveName",
            "schema": {
              "type": "string"
            },
            "required": true,
            "description": "Drive name (e.g., Documents)"
          },
          {
            "in": "query",
            "name": "itemName",
            "schema": {
              "type": "string"
            },
            "required": true,
            "description": "Workbook file name (e.g., Report.xlsx)."
          },
          {
            "in": "query",
            "name": "itemPath",
            "schema": {
              "type": "string"
            },
            "description": "Full path to disambiguate duplicates (e.g., /Folder/Sub/Report.xlsx)."
          }
        ],
        "responses": {
          "200": {
            "description": "List success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ListSheetsSuccess"
                }
              }
            }
          },
          "404": {
            "description": "Drive or file not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/read": {
      "post": {
        "summary": "Read a range from a worksheet or usedRange",
        "operationId": "readExcelRange",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReadRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Read success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReadSuccess"
                }
              }
            }
          },
          "400": {
            "description": "Bad request / ambiguity",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "$ref": "#/components/schemas/ErrorWithAvailableSheets"
                    },
                    {
                      "$ref": "#/components/schemas/ErrorWithAvailableDrives"
                    }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/write": {
      "post": {
        "summary": "Write values to a range or append after usedRange",
        "operationId": "writeExcelRange",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/WriteRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Write success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WriteSuccess"
                }
              }
            }
          },
          "400": {
            "description": "Bad request / ambiguity",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "$ref": "#/components/schemas/ErrorWithAvailableSheets"
                    },
                    {
                      "$ref": "#/components/schemas/ErrorWithAvailableDrives"
                    }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/batch": {
      "post": {
        "summary": "Batch Excel operations (reads/writes/formatting)",
        "operationId": "batchOperations",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BatchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Batch success (partial successes possible)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchSuccess"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/search": {
      "get": {
        "summary": "Recursive search for files by name",
        "operationId": "searchFiles",
        "parameters": [
          {
            "in": "query",
            "name": "siteId",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site ID override"
          },
          {
            "in": "query",
            "name": "siteUrl",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site URL override"
          },
          {
            "in": "query",
            "name": "sharepointHostname",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint hostname override (tenant.sharepoint.com)"
          },
          {
            "in": "query",
            "name": "sharepointSiteName",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint site name override (e.g., Finance)"
          },
          {
            "in": "query",
            "name": "driveName",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "fileName",
            "schema": {
              "type": "string"
            },
            "description": "Target file name (case-insensitive)."
          }
        ],
        "responses": {
          "200": {
            "description": "Search results (may include multiple paths)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchFilesSuccess"
                }
              }
            }
          },
          "404": {
            "description": "No matches found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/find-replace": {
      "post": {
        "summary": "Intelligent find & replace with optional preview and highlighting",
        "operationId": "findReplace",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FindReplaceRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation success (may include change log)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FindReplaceSuccess"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "404": {
            "description": "Targets not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "409": {
            "description": "Confirmation required (preview) or multiple matches requiring disambiguation",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    { "$ref": "#/components/schemas/ConfirmationRequired" },
                    { "$ref": "#/components/schemas/MultipleMatchError" }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/search-text": {
      "post": {
        "summary": "Search text without replacement",
        "operationId": "searchText",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SearchTextRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchTextSuccess"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/analyze-scope": {
      "get": {
        "summary": "Analyze workbook structure for find/replace planning",
        "operationId": "analyzeScope",
        "parameters": [
          {
            "in": "query",
            "name": "siteId",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site ID override"
          },
          {
            "in": "query",
            "name": "siteUrl",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint Site URL override"
          },
          {
            "in": "query",
            "name": "sharepointHostname",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint hostname override (tenant.sharepoint.com)"
          },
          {
            "in": "query",
            "name": "sharepointSiteName",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "Optional SharePoint site name override (e.g., Finance)"
          },
          {
            "in": "query",
            "name": "driveName",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "itemName",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "itemPath",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Scope metadata",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSuccessWithData"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/format": {
      "post": {
        "summary": "Apply formatting, formulas, and advanced Excel engine operations",
        "operationId": "excelFormat",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExcelFormatRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Formatting applied",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSuccessWithData"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/rename-file": {
      "post": {
        "summary": "Rename an Excel file",
        "operationId": "renameFile",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RenameFileRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rename success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RenameFileSuccess"
                }
              }
            }
          },
          "404": {
            "description": "File not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "409": {
            "description": "Multiple matches or conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MultipleMatchesResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/rename-folder": {
      "post": {
        "summary": "Rename a folder",
        "operationId": "renameFolder",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RenameFolderRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rename success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RenameSuccess"
                }
              }
            }
          },
          "404": {
            "description": "Folder not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "409": {
            "description": "Multiple matches or conflict",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MultipleMatchError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/rename-sheet": {
      "post": {
        "summary": "Rename a worksheet within a workbook",
        "operationId": "renameSheet",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RenameSheetRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rename success",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RenameSuccess"
                }
              }
            }
          },
          "404": {
            "description": "Sheet not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/rename-suggestions": {
      "post": {
        "summary": "Get intelligent rename suggestions for related items",
        "operationId": "renameSuggestions",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RenameSuggestionsRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Suggestions returned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSuccessWithData"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/batch-rename": {
      "post": {
        "summary": "Perform multiple rename operations in batch",
        "operationId": "batchRename",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BatchRenameRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Batch rename results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchRenameSuccess"
                }
              }
            }
          },
          "207": {
            "description": "Multi-status for partial successes",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BatchRenameSuccess"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/create-file": {
      "post": {
        "summary": "Create a new Excel file in a drive/folder",
        "operationId": "createFile",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateFileRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSuccessWithData"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "409": {
            "description": "Conflict - file exists",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/create-sheet": {
      "post": {
        "summary": "Add a worksheet to a workbook",
        "operationId": "createSheet",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateSheetRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sheet created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSuccessWithData"
                }
              }
            }
          },
          "400": {
            "description": "Bad request or duplicate name",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "404": {
            "description": "Drive or file not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/delete-file": {
      "delete": {
        "summary": "Delete a workbook by name (use itemPath to disambiguate)",
        "operationId": "deleteFile",
        "parameters": [
          {
            "in": "query",
            "name": "siteId",
            "schema": {
              "type": "string"
            },
            "required": false
          },
          {
            "in": "query",
            "name": "siteUrl",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteFileRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "File deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSuccessWithData"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "409": {
            "description": "Multiple matches",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MultipleMatchError"
                }
              }
            }
          }
        }
      }
    },
    "/api/excel/delete-sheet": {
      "delete": {
        "summary": "Delete a worksheet from a workbook (not the last)",
        "operationId": "deleteSheet",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeleteSheetRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sheet deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSuccessWithData"
                }
              }
            }
          },
          "400": {
            "description": "Cannot delete last sheet or bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "parameters": {
      "siteId": {
        "name": "siteId",
        "in": "query",
        "schema": {
          "type": "string"
        },
        "required": false,
        "description": "Optional SharePoint Site ID override"
      },
      "siteUrl": {
        "name": "siteUrl",
        "in": "query",
        "schema": {
          "type": "string"
        },
        "required": false,
        "description": "Optional SharePoint Site URL override"
      },
      "sharepointHostname": {
        "name": "sharepointHostname",
        "in": "query",
        "schema": {
          "type": "string"
        },
        "required": false,
        "description": "Optional SharePoint hostname override (tenant.sharepoint.com)"
      },
      "sharepointSiteName": {
        "name": "sharepointSiteName",
        "in": "query",
        "schema": {
          "type": "string"
        },
        "required": false,
        "description": "Optional SharePoint site name override (e.g., Finance)"
      }
    },
    "schemas": {
      "EnvelopeSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success"
            ],
            "example": "success"
          }
        },
        "required": [
          "status"
        ]
      },
      "EnvelopeSuccessWithData": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success"
            ],
            "example": "success"
          },
          "data": {}
        },
        "required": [
          "status"
        ]
      },
      "EnvelopeError": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "error"
            ],
            "example": "error"
          },
          "error": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "object",
                "additionalProperties": true
              }
            ]
          }
        },
        "required": [
          "status",
          "error"
        ]
      },
      "MultipleMatchError": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeError"
          },
          {
            "type": "object",
            "properties": {
              "options": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Candidate full paths for disambiguation"
              }
            }
          }
        ]
      },
      "ErrorWithAvailableSheets": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeError"
          },
          {
            "type": "object",
            "properties": {
              "availableSheets": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        ]
      },
      "ErrorWithAvailableDrives": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeError"
          },
          {
            "type": "object",
            "properties": {
              "availableDrives": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        ]
      },
      "HealthSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success"
            ],
            "example": "success"
          },
          "data": {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "example": "ok"
              },
              "time": {
                "type": "string",
                "format": "date-time"
              }
            },
            "required": [
              "status",
              "time"
            ]
          }
        },
        "required": [
          "status",
          "data"
        ]
      },
      "HealthDetailedSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success",
              "error"
            ],
            "example": "success"
          },
          "data": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "required": [
          "status",
          "data"
        ]
      },
      "ListItemsSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success"
            ],
            "example": "success"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "string" },
                "name": { "type": "string" },
                "driveId": { "type": "string" },
                "driveName": { "type": "string" },
                "fullPath": { "type": "string", "example": "/Reports/2024/3.1- Materiality.xlsx" }
              },
              "additionalProperties": true
            }
          }
        },
        "required": [
          "status",
          "data"
        ]
      },
      "ListSheetsSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success"
            ],
            "example": "success"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "position": {
                  "type": "integer"
                },
                "visibility": {
                  "type": "string"
                }
              },
              "required": [
                "id",
                "name"
              ]
            }
          }
        },
        "required": [
          "status",
          "data"
        ]
      },
      "SearchFilesSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success"
            ],
            "example": "success"
          },
          "matches": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "path": {
                  "type": "string"
                }
              },
              "required": [
                "name",
                "path"
              ]
            }
          }
        },
        "required": [
          "status",
          "matches"
        ]
      },
      "RangeObject": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "address": {
            "type": "string"
          },
          "values": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {}
            }
          }
        }
      },
      "MessageValues": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "values": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {}
            }
          }
        },
        "required": [
          "message",
          "values"
        ]
      },
      "ReadRequest": {
        "type": "object",
        "description": "Names-first: provide driveName and itemName. sheetName optional; you can also prefix the range with Sheet!A1:B2.",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "sheetName": {
            "type": "string"
          },
          "range": {
            "type": "string",
            "description": "Optional. If omitted, the API returns the worksheet's usedRange."
          }
        },
        "required": [
          "driveName",
          "itemName"
        ]
      },
      "ReadSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success",
              "no_matches",
              "preview"
            ],
            "example": "success"
          },
          "data": {
            "oneOf": [
              {
                "$ref": "#/components/schemas/RangeObject"
              },
              {
                "$ref": "#/components/schemas/MessageValues"
              },
              {
                "type": "object",
                "additionalProperties": true
              }
            ]
          }
        },
        "required": [
          "status",
          "data"
        ]
      },
      "WriteRequest": {
        "type": "object",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "values": {
            "type": "array",
            "items": {
              "type": "array",
              "items": {}
            },
            "description": "2D array of values"
          }
        },
        "required": [
          "driveName",
          "itemName",
          "values"
        ]
      },
      "ClearDataRequest": {
        "type": "object",
        "properties": {
          "driveName": { "type": "string" },
          "itemName": { "type": "string" },
          "itemPath": { "type": "string" },
          "worksheetName": { "type": "string" },
          "sheetName": { "type": "string" },
          "range": { "type": "string", "description": "Optional. If omitted, clears usedRange of the worksheet." }
        },
        "required": ["driveName", "itemName"]
      },
      "ClearDataSuccess": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "enum": ["success"], "example": "success" },
          "data": {
            "type": "object",
            "properties": {
              "cleared": { "type": "boolean" },
              "worksheetId": { "type": "string" },
              "range": { "type": "string" }
            },
            "required": ["cleared"]
          }
        },
        "required": ["status", "data"]
      },
      "BatchRequest": {
        "type": "object",
        "properties": {
          "operations": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            }
          }
        },
        "required": [
          "operations"
        ]
      },
      "BatchSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success",
              "partial_success"
            ],
            "example": "success"
          },
          "results": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            }
          }
        },
        "required": [
          "status"
        ]
      },
      "ExcelFormatRequest": {
        "type": "object",
        "description": "Supports formatting (font, fill, borders), formulas, validation, pivot tables, conditional formatting, named ranges, sorting/filtering.",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "sheetName": {
            "type": "string"
          },
          "operations": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            },
            "description": "Engine operations grouped by type for batching."
          },
          "formula": {
            "type": "object",
            "properties": {
              "expression": {
                "type": "string"
              },
              "targetCell": {
                "type": "string"
              },
              "overwrite": {
                "type": "boolean"
              }
            }
          }
        },
        "required": [
          "driveName",
          "itemName"
        ]
      },
      "FindReplaceRequest": {
        "type": "object",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "scope": {
            "type": "string",
            "enum": [
              "header_only",
              "specific_range",
              "entire_sheet",
              "all_sheets"
            ],
            "default": "entire_sheet"
          },
          "sheetName": {
            "type": "string"
          },
          "rangeSpec": {
            "type": "string"
          },
          "searchTerm": {
            "type": "string"
          },
          "replaceTerm": {
            "type": "string"
          },
          "confirm": {
            "type": "boolean",
            "default": false
          },
          "highlightChanges": {
            "type": "boolean",
            "default": false
          },
          "logChanges": {
            "type": "boolean",
            "default": true
          },
          "previewId": {
            "type": "string"
          }
        },
        "required": [
          "driveName",
          "itemName",
          "searchTerm"
        ]
      },
      "FindReplaceSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success",
              "preview",
              "no_matches",
              "partial_success"
            ],
            "example": "success"
          },
          "changes": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            }
          },
          "summary": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "required": [
          "status"
        ]
      },
      "SearchTextRequest": {
        "type": "object",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "scope": {
            "type": "string",
            "enum": [
              "header_only",
              "specific_range",
              "entire_sheet",
              "all_sheets"
            ],
            "default": "entire_sheet"
          },
          "sheetName": {
            "type": "string"
          },
          "rangeSpec": {
            "type": "string"
          },
          "searchTerm": {
            "type": "string"
          }
        },
        "required": [
          "itemName",
          "searchTerm"
        ]
      },
      "SearchTextSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success",
              "no_matches"
            ],
            "example": "success"
          },
          "results": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            }
          }
        },
        "required": [
          "status"
        ]
      },
      "RenameFileRequest": {
        "type": "object",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string",
            "description": "Optional. If omitted, search all accessible drives."
          },
          "itemName": {
            "type": "string",
            "description": "Current file name. Required if selectedItemId is not provided."
          },
          "itemPath": {
            "type": "string",
            "description": "Optional disambiguation path like /Folder/Sub/file.xlsx (within the drive)."
          },
          "selectedItemId": {
            "type": "string",
            "description": "Optional. Use this on the second call after a 409 multiple_matches to select the exact item."
          },
          "oldName": {
            "type": "string",
            "description": "Optional. Previous name for logging/backward compatibility."
          },
          "newName": {
            "type": "string",
            "description": "New file name."
          }
        },
        "required": [
          "newName"
        ],
        "anyOf": [
          { "required": ["itemName"] },
          { "required": ["selectedItemId"] }
        ]
      },
      "RenameFolderRequest": {
        "type": "object",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string"
          },
          "folderPath": {
            "type": "string",
            "description": "Full path to target folder."
          },
          "newName": {
            "type": "string"
          }
        },
        "required": [
          "folderPath",
          "newName"
        ]
      },
      "RenameSheetRequest": {
        "type": "object",
        "properties": {
          "siteId": {
            "type": "string"
          },
          "siteUrl": {
            "type": "string"
          },
          "sharepointHostname": {
            "type": "string"
          },
          "sharepointSiteName": {
            "type": "string"
          },
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "sheetName": {
            "type": "string",
            "description": "Current sheet name."
          },
          "newName": {
            "type": "string"
          }
        },
        "required": [
          "itemName",
          "sheetName",
          "newName"
        ]
      },
      "RenameSuggestionsRequest": {
        "type": "object",
        "properties": {
          "searchTerm": {
            "type": "string"
          },
          "context": {
            "type": "string"
          }
        },
        "required": [
          "searchTerm"
        ]
      },
      "BatchRenameRequest": {
        "type": "object",
        "properties": {
          "operations": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": [
                    "file",
                    "folder",
                    "sheet"
                  ]
                },
                "target": {
                  "type": "object",
                  "additionalProperties": true
                },
                "newName": {
                  "type": "string"
                }
              },
              "required": [
                "type",
                "target",
                "newName"
              ]
            }
          }
        },
        "required": [
          "operations"
        ]
      },
      "RenameFileSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["success"],
            "example": "success"
          },
          "data": {
            "type": "object",
            "properties": {
              "file": { "type": "object", "additionalProperties": true },
              "message": { "type": "string", "example": "Renamed: Drive/Folder/Old -> Drive/Folder/New" },
              "pathBefore": { "type": "string" },
              "pathAfter": { "type": "string" }
            },
            "required": ["message"]
          }
        },
        "required": ["status", "data"]
      },

      "MultipleMatchesResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string", "enum": ["multiple_matches"], "example": "multiple_matches" },
          "message": { "type": "string", "example": "Multiple files found with that name. Please pick one." },
          "matches": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "string" },
                "name": { "type": "string" },
                "driveName": { "type": "string" },
                "breadcrumb": { "type": "string" },
                "fullPath": { "type": "string" },
                "path": { "type": "string" },
                "parentId": { "type": "string" },
                "webUrl": { "type": "string" },
                "lastModified": { "type": "string", "format": "date-time" },
                "size": { "type": "integer" }
              },
              "required": ["id", "name", "driveName", "fullPath", "path"]
            }
          }
        },
        "required": ["status", "message", "matches"]
      },
      "RenameSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["success"],
            "example": "success"
          },
          "message": { "type": "string" }
        },
        "required": ["status"]
      },
      "BatchRenameSuccess": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "success",
              "partial_success"
            ],
            "example": "success"
          },
          "results": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            }
          }
        },
        "required": [
          "status",
          "results"
        ]
      },
      "CreateFileRequest": {
        "type": "object",
        "properties": {
          "driveName": {
            "type": "string"
          },
          "parentPath": {
            "type": "string",
            "description": "Like /Projects/2024; default root"
          },
          "fileName": {
            "type": "string",
            "pattern": ".*\\.xlsx$"
          },
          "template": {
            "type": "string",
            "enum": [
              "blank"
            ],
            "default": "blank"
          }
        },
        "required": [
          "driveName",
          "fileName"
        ]
      },
      "CreateSheetRequest": {
        "type": "object",
        "properties": {
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "sheetName": {
            "type": "string"
          },
          "position": {
            "type": "integer",
            "minimum": 0
          }
        },
        "required": [
          "driveName",
          "itemName",
          "sheetName"
        ]
      },
      "DeleteFileRequest": {
        "type": "object",
        "properties": {
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "force": {
            "type": "boolean"
          }
        },
        "required": [
          "driveName",
          "itemName"
        ]
      },
      "DeleteSheetRequest": {
        "type": "object",
        "properties": {
          "driveName": {
            "type": "string"
          },
          "itemName": {
            "type": "string"
          },
          "itemPath": {
            "type": "string"
          },
          "sheetName": {
            "type": "string"
          }
        },
        "required": [
          "driveName",
          "itemName",
          "sheetName"
        ]
      }
    }
  }
}